# 4.1 배포 옵션 비교

[← 목차로 돌아가기](../../README.md)

본 시스템은 **세 가지 배포 방식** 중 선택 가능하도록 설계되었습니다. 각 옵션은 12-Factor App 원칙에 따라 환경 변수 기반으로 구성되어, 코드 변경 없이 배포 환경을 전환할 수 있습니다.

## 4.1.1 배포 옵션 개요

| 구분 | Option A: 온프레미스 | Option B-1: Railway | Option B-2: AWS |
|------|---------------------|---------------------|-----------------|
| **배포 방식** | 자체 서버 구축 | Cloud PaaS | Cloud IaaS |
| **인프라** | 물리 서버 구매/설치 | Railway 플랫폼 | EC2, RDS, ElastiCache |
| **데이터베이스** | 자체 PostgreSQL | Railway PostgreSQL | AWS RDS PostgreSQL |
| **캐시** | 자체 Redis | Railway Redis | AWS ElastiCache |
| **파일 저장소** | 로컬 스토리지 | Railway Volume | AWS S3 |
| **네트워크 요구사항** | 내부 LAN만 필요 | **인터넷 필수** | **인터넷 필수** |
| **배포 시간** | 4-6주 | 1주 | 2-3주 |
| **확장 방식** | 서버 추가 구매 | 자동 스케일링 | 수동/자동 스케일링 |

> ⚠️ **중요**: 클라우드 옵션(Railway/AWS)을 선택하면 **생산 라인의 모든 작업 PC가 인터넷에 연결**되어야 합니다.

## 4.1.2 상세 비교

### 초기 투자 비용

| 항목 | 온프레미스 | Railway | AWS |
|------|-----------|---------|-----|
| **서버/인프라** | 4,985만원 | 0원 | 0원 |
| **개발비** | 1,805만원 | 1,805만원 | 1,805만원 |
| **합계** | **6,790만원** | **1,805만원** | **1,805만원** |

**온프레미스 서버 구성 (4,985만원):**
- 백엔드 서버: Dell PowerEdge R250 (2대) - 1,800만원
- DB 서버: Dell PowerEdge R350 (1대) - 1,200만원
- 네트워크 장비: 스위치, 라우터, UPS - 800만원
- 설치/구축비: 케이블링, 랙 구성 - 500만원
- 기타: 라이선스, 보안 솔루션 - 685만원

### 월 운영 비용

| 항목 | 온프레미스 | Railway | AWS |
|------|-----------|---------|-----|
| **인프라 비용** | 0원 | 26만원 | 220-350만원 |
| **전기/네트워크** | 20만원 | 0원 | 0원 |
| **유지보수** | 93만원 | 0원 | 0원 |
| **합계** | **113만원** | **26만원** | **220-350만원** |

**Railway 상세 (월 26만원):**
- Hobby Plan: $20/월 (약 26만원)
- PostgreSQL, Redis, 백엔드 포함
- 500MB RAM, 1GB Storage 기본 제공
- 트래픽: 무제한

**AWS 상세 (월 220-350만원):**
- EC2 t3.medium (2대): $60/월
- RDS PostgreSQL db.t3.medium: $80/월
- ElastiCache Redis t3.micro: $15/월
- S3 Storage: $10/월
- Data Transfer: $50-180/월 (변동)

**온프레미스 유지보수 (월 93만원):**
- 전기료: 20만원/월
- 시스템 관리: 50만원/월 (파트타임 관리자)
- 백업/모니터링 툴: 23만원/월

### 3년 총 소유 비용 (TCO)

| 구분 | 온프레미스 | Railway | AWS |
|------|-----------|---------|-----|
| **초기 투자** | 6,790만원 | 1,805만원 | 1,805만원 |
| **36개월 운영** | 4,068만원 | 936만원 | 7,920-12,600만원 |
| **3년 총 비용** | **10,858만원** | **2,741만원** | **9,725-14,405만원** |

### 개발 일정

| 단계 | 온프레미스 | Railway | AWS |
|------|-----------|---------|-----|
| **인프라 구축** | 2-3주 | 0일 | 3-5일 |
| **네트워크 설정** | 1주 | 0일 | 2-3일 |
| **백엔드 개발** | 8주 | 8주 | 8주 |
| **배포/테스트** | 1주 | 2일 | 3-5일 |
| **합계** | **12-13주** | **8주** | **9-10주** |

### 장단점 비교

**Option A: 온프레미스**

**장점:**
- ✅ 데이터 완전 통제 (보안 중시 기업에 적합)
- ✅ 장기 운영 시 월 비용 낮음 (월 113만원)
- ✅ **인터넷 불필요** - 내부 LAN만으로 운영 가능
- ✅ **네트워크 단절 시에도 작업 가능** (외부 의존성 없음)
- ✅ 커스터마이징 자유도 높음
- ✅ 공장 보안 정책 준수 용이

**단점:**
- ❌ 초기 투자 비용 높음 (6,790만원)
- ❌ 구축 기간 길음 (12-13주)
- ❌ 시스템 관리자 필요
- ❌ 하드웨어 장애 시 복구 부담
- ❌ 확장 시 서버 추가 구매 필요

**추천 대상:**
- 데이터 보안이 최우선인 기업
- **공장 보안 정책상 인터넷 연결 제한**이 있는 경우
- 3년 이상 장기 운영 계획
- IT 인프라 관리 인력 보유
- 초기 투자 여력 있음

---

**Option B-1: Railway (Cloud PaaS)**

**장점:**
- ✅ 초기 투자 최소화 (1,805만원)
- ✅ 가장 빠른 배포 (8주)
- ✅ 월 비용 최저 (26만원)
- ✅ 인프라 관리 불필요
- ✅ 자동 백업/모니터링 제공
- ✅ 개발자 친화적 (GitHub 연동 자동 배포)

**단점:**
- ❌ 플랫폼 종속성 (Railway 의존)
- ❌ 커스터마이징 제약
- ❌ 대규모 트래픽 시 비용 급증 가능
- ❌ **인터넷 연결 필수** - 네트워크 단절 시 작업 불가
- ❌ 데이터가 외부 서버에 저장 (보안 검토 필요)

**추천 대상:**
- 빠른 시작이 중요한 스타트업
- IT 인프라 관리 인력 부족
- 초기 투자 최소화 필요
- **공장 인터넷 연결 가능**
- 클라우드 기반 확장 계획

---

**Option B-2: AWS (Cloud IaaS)**

**장점:**
- ✅ 초기 투자 낮음 (1,805만원)
- ✅ 엔터프라이즈급 신뢰성
- ✅ 세밀한 인프라 제어 가능
- ✅ 다양한 AWS 서비스 통합 가능
- ✅ 대규모 확장성 (글로벌 인프라)
- ✅ VPN/VPC를 통한 보안 강화 가능

**단점:**
- ❌ 월 비용 높음 (220-350만원)
- ❌ AWS 전문 지식 필요
- ❌ 설정/관리 복잡도 높음
- ❌ 트래픽 비용 예측 어려움
- ❌ **인터넷 연결 필수** - 네트워크 단절 시 작업 불가
- ❌ 데이터가 외부 서버에 저장 (보안 검토 필요)

**추천 대상:**
- 엔터프라이즈급 안정성 필요
- AWS 기존 인프라 보유
- **공장 인터넷 연결 가능**
- 글로벌 확장 계획
- 클라우드 전문 인력 보유

## 4.1.3 의사결정 가이드

**1단계: 네트워크 환경 검토 ⚠️ (최우선)**

```
Q1. 공장에서 인터넷 연결이 가능한가?
├─ NO  → 온프레미스 (유일한 선택)
└─ YES → 2단계로 진행
```

> **중요**: 클라우드 옵션은 **모든 작업 PC가 인터넷에 연결**되어야 합니다.
> - 보안 정책상 인터넷 차단: 온프레미스만 가능
> - 네트워크 불안정: 온프레미스 권장

**2단계: 초기 투자 검토**

```
Q2. 초기 투자 6,790만원 가능한가?
├─ YES → 온프레미스 검토
└─ NO  → Railway 또는 AWS 검토
```

**3단계: 운영 기간 검토**

```
Q3. 3년 이상 장기 운영 계획인가?
├─ YES → 온프레미스 (3년 TCO: 10,858만원)
└─ NO  → Railway (3년 TCO: 2,741만원)
```

**4단계: 데이터 보안 요구사항**

```
Q4. 데이터를 반드시 자체 서버에 보관해야 하는가?
├─ YES → 온프레미스
└─ NO  → Railway 또는 AWS
```

**5단계: IT 인프라 관리 능력**

```
Q5. IT 인프라 관리 인력이 있는가?
├─ YES → 온프레미스 또는 AWS
└─ NO  → Railway (관리 불필요)
```

**5단계: 확장성 요구사항**

```
Q5. 향후 급격한 확장 가능성이 있는가?
├─ YES → Railway (자동 스케일링) 또는 AWS (대규모 확장)
└─ NO  → 온프레미스 (안정적 소규모 운영)
```

## 4.1.4 네트워크 및 보안 고려사항

### 네트워크 연결 방식 비교

**Option A: 온프레미스**

```
생산 라인 작업 PC (공장 내부)
    ↓
내부 LAN (로컬 네트워크, 예: 192.168.1.0/24)
    ↓
MES 서버 (공장 내부, 예: 192.168.1.100)
```

**특징:**
- ✅ 인터넷 불필요
- ✅ 외부 네트워크 완전 차단 가능
- ✅ 데이터가 공장 내부에만 존재
- ✅ 네트워크 장애 시 외부 영향 없음
- ✅ 공장 보안 정책 준수 용이

---

**Option B: 클라우드 (Railway/AWS)**

```
생산 라인 작업 PC (공장 내부)
    ↓
공장 방화벽 (Port 443 HTTPS 허용 필요)
    ↓
인터넷 (ISP 회선)
    ↓
클라우드 서버 (외부, Railway 또는 AWS)
```

**특징:**
- ⚠️ **인터넷 연결 필수**
- ⚠️ 네트워크 단절 시 작업 불가
- ⚠️ 데이터가 외부 서버에 저장
- ⚠️ ISP 장애 시 전체 시스템 중단
- ✅ 외부에서 관리 대시보드 접근 가능

### 클라우드 사용 시 보안 강화 방안

클라우드 옵션을 선택할 경우, 다음 보안 조치를 **반드시** 적용해야 합니다:

**1. VPN 터널 (권장)**
```
작업 PC → VPN 클라이언트 → 암호화 터널 → 클라우드 서버
```
- IPsec 또는 WireGuard VPN 사용
- 모든 트래픽 암호화
- 비용: 월 5-10만원 추가

**2. 방화벽 화이트리스트**
```python
# AWS Security Group 설정 예시
allowed_ips = [
    "공장 IP 주소/32",  # 예: 123.456.789.0/32
]
```
- 공장 IP만 접근 허용
- 다른 IP 차단

**3. SSL/TLS 암호화 (필수)**
```
모든 API 호출: HTTPS (TLS 1.3)
데이터 전송: AES-256 암호화
```

**4. 데이터 주권 고려**
- AWS: 서울 리전(ap-northeast-2) 사용 권장
- Railway: 한국 내 데이터 센터 확인 필요
- 개인정보/민감 데이터: 국내 법규 준수

### 네트워크 요구사항

**온프레미스:**
- 필요 대역폭: 최소 100Mbps (내부 LAN)
- 권장: Gigabit 스위치 (1000Mbps)

**클라우드 (Railway/AWS):**
- 필요 대역폭: 최소 50Mbps (인터넷 회선)
- 권장: 100Mbps 이상
- 동시 접속자 100명 기준: 약 20-30Mbps 사용
- ISP 이중화 권장 (주 회선 + 백업 회선)

---

## 4.1.5 마이그레이션 전략

**온프레미스 → 클라우드 전환:**

본 시스템은 12-Factor App 원칙에 따라 설계되어, 환경 변수만 변경하면 배포 환경을 전환할 수 있습니다.

**1단계: 환경 변수 변경**

```bash
# 온프레미스
DATABASE_URL=postgresql://user:pass@192.168.1.100:5432/mes_db
REDIS_URL=redis://192.168.1.101:6379
FILE_STORAGE=local

# Railway로 전환
DATABASE_URL=postgresql://user:pass@railway.app:5432/mes_db
REDIS_URL=redis://railway.app:6379
FILE_STORAGE=railway_volume

# AWS로 전환
DATABASE_URL=postgresql://user:pass@mes-db.rds.amazonaws.com:5432/mes_db
REDIS_URL=redis://mes-cache.elasticache.amazonaws.com:6379
FILE_STORAGE=s3://mes-bucket
```

**2단계: 데이터 마이그레이션**

```bash
# PostgreSQL 데이터 덤프
pg_dump -h 192.168.1.100 -U mes_user mes_db > mes_backup.sql

# Railway/AWS로 복원
psql $DATABASE_URL < mes_backup.sql
```

**3단계: 파일 마이그레이션**

```bash
# 로컬 파일 → S3 (AWS의 경우)
aws s3 sync /var/mes/files/ s3://mes-bucket/

# 로컬 파일 → Railway Volume
railway volume upload /var/mes/files/
```

**마이그레이션 다운타임:** 2-4시간 (데이터 크기에 따라)

## 4.1.6 하이브리드 옵션

**시작: Railway → 성장: AWS → 성숙: 온프레미스**

일부 기업은 단계별로 배포 전략을 변경하기도 합니다:

1. **Phase 1 (0-1년):** Railway로 빠르게 시작
   - 초기 투자 최소화
   - 빠른 시장 진입
   - 월 26만원 운영

2. **Phase 2 (1-2년):** AWS로 전환
   - 안정성 강화 필요 시
   - 더 많은 제어권 필요 시
   - 월 220-350만원 운영

3. **Phase 3 (3년+):** 온프레미스 전환
   - 3년 이상 장기 운영 확정 시
   - TCO 최적화 (3년차부터 온프레미스가 유리)
   - 초기 6,790만원 투자 후 월 113만원 운영

---

**다음 섹션:** [4.2 시스템 구성도](04-2-system-design.md)
