# 2. 제품 및 공정 현황 (AS-IS)

> [← 목차로 돌아가기](./README.md)

---

## 2.1 제품 소개

**제품명:** Withforce Wearable Robot

**용도:** 산업용/농업용 허리 보조 로봇

**핵심 구성품:** LMA (Linear Muscle Actuator)

**LMA 구성:**

- SMA (Shape Memory Alloy) 스프링
- 모선 케이블
- 제어 보드
- 센서 (온도, TOF)

---

## 2.2 현재 생산 공정 흐름

> **주요 용어**: LMA, SMA 스프링, 모선, TOF 등의 용어 정의는 [7. 부록 - 용어 정의](./07-appendix.md#71-용어-정의) 참조

```mermaid
graph LR
    A[레이저 마킹] --> B[LMA 조립] --> C[센서 검사] --> D[펌웨어 업로드]
    D --> E[로봇 조립] --> F[성능검사] --> G[라벨 프린팅] --> H[포장 + 외관검사]
```

**공정 개수:** 8개

**일일 생산 목표:** 약 100대

**작업 방식:** LOT 단위 (100대), 작업대차로 이동

---

## 2.4 공정별 상세 설명

> **공통 사항:** 모든 공정은 작업자가 수동으로 제품을 투입하고 배출합니다. 각 공정의 소요 시간에는 투입/배출 시간이 포함되어 있습니다.

### 2.4.1 공정 1: 레이저 마킹

**작업 내용:**
- LMA에 LOT 번호 레이저 각인

**소요 시간:** 약 60초

**품질 검사:**
- 바코드 리더기로 판독 확인
- 판독 성공 시: 합격
- 판독 실패 시: 불합격

**재작업:** 불가능 (레이저 마킹 특성상)

**작업자:** 1명

**비고:** 마킹 실패 시 해당 LMA는 불량 처리

### 2.4.2 공정 2: LMA 조립

**작업 내용:**

- 플라스틱 부품 + SMA 스프링 조립
- 조립 순서에 따른 수작업

**소요 시간:** 약 1시간 (작업자 숙련도에 따라 편차 큼)

**품질 검사:** 작업자 육안 검사

**주요 불량 원인:**

- 조립 실수 (부품 순서 오류, 체결 불량)
- 부품 불량 (스프링 변형, 플라스틱 파손)

**재작업:** 가능 (해당 부품 교체 또는 재조립)

**작업자:** 1명

**비고:** 숙련 작업자는 40분, 신입 작업자는 1.5시간 소요

### 2.4.3 공정 3: 센서 검사

**검사 항목:**

1. **온도 센서 검사**
   - 검사 온도: 60℃
   - 합격 기준: ±1℃ (59℃ ~ 61℃)

2. **TOF 센서 검사**
   - 검사 내용: I2C 통신 연결 확인

**소요 시간:** 약 60초

**불량률:** 거의 없음 (센서 자체 불량이 아니면 통과)

**불합격 시 처리:**

- 1차: 재검사 실시
- 2차 불합격: 센서 교체 후 재검사
- 3차 불합격: 불량 처리

**재작업:** 가능 (센서 교체)

**작업자:** 1명

### 2.4.4 공정 4: 펌웨어 업로드

**작업 내용:**

- 대상: 제어 보드 MCU
- 펌웨어 제공: 서버 → 프론트엔드 → Local App → 제어 보드
- 버전 관리: 서버에서 펌웨어 버전 관리

**소요 시간:** 약 60초

**업로드 실패:** 종종 발생 (통신 불안정, 케이블 접촉 불량)

**실패 시 처리:**

- 자동 재시도 (최대 3회)
- 3회 실패 시: 작업자 수동 재시도
- 지속 실패 시: 제어 보드 교체

**펌웨어 버전 업데이트:** 자주 발생 (주 1회 이상)

**작업자:** 1명

**비고:** MES 시스템에서 최신 펌웨어 버전 자동 배포 필요

### 2.4.5 공정 5: 로봇 조립

**작업 내용:**

- LMA를 로봇 본체에 조립
- 케이블 연결 및 고정

**소요 시간:** 약 1시간

**품질 검사:** 육안 외관 검사

**주요 확인 사항:**

- LMA 체결 상태
- 케이블 연결 상태 (단선, 접촉 불량)
- 외관 손상 여부

**재작업:** 가능 (조립 불량 시 재조립)

**작업자:** 1명

**비고:** 케이블 연결 불량이 주요 불량 원인

### 2.4.6 공정 6: 성능검사

**측정 항목:**

1. **온도** (℃): LMA 구동기 가열 온도
2. **변위** (mm): LMA 구동기 이동 거리
3. **힘** (kgf): LMA 구동기가 발생하는 힘

**검사 프로토콜 예시:**

- 조건: 200mm 변위에서 LMA 구동기를 52℃로 가열
- 측정: 발생하는 힘(kgf) 측정

**측정 데이터 합격 범위:**

- 특정 온도와 스트로크(변위) 조건에서 측정된 힘(kgf)이 목표값 ±2kgf 범위 내

**검사 횟수:** 1대당 1회

**소요 시간:** 약 10분

**불량률:** 거의 없음 (이전 공정이 정상이면 대부분 통과)

**불합격 시 처리:**

- 재측정 실시
- 2회 불합격: 원인 분석 (센서, LMA 조립, 펌웨어 등)
- 해당 부품 재작업 후 재검사

**재작업:** 가능

**작업자:** 1명

### 2.4.7 공정 7: 라벨 프린팅

**작업 내용:**

- 시리얼 번호 자동 생성
- 바코드 라벨 출력 (Zebra 프린터)
- 로봇 본체에 라벨 부착

**시리얼 번호 형식:** `KR01PSA25110010001`

**라벨 규격:**

- 크기: 60mm × 20mm
- 내용: 시리얼 번호, LOT 번호, 제품명, 생산일자

**부착 위치:** 로봇 본체 (지정 위치)

**소요 시간:**

- 라벨 출력: 약 10초
- 라벨 부착: 약 30초
- 총 소요: 약 40초

**작업자:** 1명

**비고:** 라벨 손상/분실 시 재출력 가능

### 2.4.8 공정 8: 포장 + 외관검사

**작업 내용:**

- 로봇 외관 최종 검사
- 포장 (비닐 + 박스)

**외관 검사 항목:** (구체적 기준 미정립)

- 스크래치 확인
- 오염 확인
- 부품 누락 확인
- 라벨 부착 상태 확인

**포장 자재:**

- 비닐: 로봇 보호용
- 박스: 외부 포장 박스

**작업자:** 1명

**비고:** 외관검사 기준 명확화 필요 (MES 도입 시 체크리스트 수립 예정)

### 2.4.9 공정 특성 요약

| 공정 | 소요 시간 | 작업자 | 불량률 | 재작업 가능 | 병목 여부 |
|------|----------|--------|--------|-----------|----------|
| 1. 레이저 마킹 | 60초 | 1명 | 낮음 | 불가 | - |
| 2. LMA 조립 | 1시간 | 1명 | 중간 | 가능 | **병목** |
| 3. 센서 검사 | 60초 | 1명 | 매우 낮음 | 가능 | - |
| 4. 펌웨어 업로드 | 60초 | 1명 | 중간 | 가능 | - |
| 5. 로봇 조립 | 1시간 | 1명 | 중간 | 가능 | **병목** |
| 6. 성능검사 | 10분 | 1명 | 매우 낮음 | 가능 | - |
| 7. 라벨 프린팅 | 60초 | 1명 | 낮음 | 가능 | - |
| 8. 포장+외관검사 | 미정 | 1명 | 낮음 | - | - |

**총 작업자:** 8명 (각 공정당 1명)

**공정 간 이동 시간:** 30초 이내 (작업대차 이동)

**총 생산 시간:** 약 2시간 10분 + 공정 간 대기 시간

**주요 병목 구간:** 공정 2 (LMA 조립), 공정 5 (로봇 조립)

---

## 2.5 현재 문제점 및 개선 필요사항

### 2.5.1 현재 생산 관리 방식

**기록 방식:** 없음 (전혀 기록하지 않음)

**작업 지시:** 구두 또는 화이트보드

**품질 관리:** 개별 작업자 판단

### 2.5.2 주요 문제점

**1. 추적성(Traceability) 부재**

- 문제 발생 시 원인 추적 불가능
- 어떤 모선 케이블을 사용했는지 알 수 없음
- 어느 공정에서 불량이 발생했는지 파악 불가

**2. 실시간 현황 파악 불가**

- 현재 생산 진행 상황을 알 수 없음
- 각 공정별 진행률 미파악
- 병목 구간 식별 불가

**3. 품질 데이터 미수집**

- 온도, 변위, 힘 측정 데이터 저장 안 됨
- 통계 분석 불가능
- 개선 근거 데이터 부족

### 2.5.3 개선 목표

**정성적 목표:**

1. ✅ **실시간 모니터링**: 언제 어디서나 생산 현황 파악
2. ✅ **완벽한 추적성**: 시리얼 번호 → LOT → 공정 이력 → 부품 LOT 추적
3. ✅ **데이터 기반 의사결정**: 측정 데이터 수집 및 분석
4. ✅ **업무 효율성**: 자동화를 통한 작업 시간 단축

**정량적 목표:**

- LOT 생성 시간: 5분 → 30초
- 불량 원인 파악 시간: 불가능 → 5분 이내
- 생산 진행 현황 파악 시간: 1시간 → 실시간
- 완제품 수량 파악 시간: 수동 집계 → 실시간
- 공정별 재공품(WIP) 파악 시간: 파악 불가 → 실시간

---

## 2.6 LOT 및 시리얼 번호 체계

### 2.6.1 LOT 번호 체계

**형식:** `[국가코드][라인번호][모델코드][생산월][순번]`

**예시:** `KR01PSA2511001`

**구성 요소:**

| 구분 | 길이 | 설명 | 예시 | 비고 |
|------|------|------|------|------|
| 국가코드 | 2자리 | 생산 국가 코드 | KR | 한국=KR, 미국=US |
| 라인번호 | 2자리 | 생산 라인 번호 | 01 | 01~99 |
| 모델코드 | 3자리 | 제품 모델 약어 | PSA | PSA10→PSA, Withforce→WFO |
| 생산월 | 4자리 | 생산 월 | 2511 | YYMM 형식 (2025년 11월) |
| 순번 | 3자리 | 일련번호 | 001 | 월별 해당 모델 생성 순서 (001~999) |

**전체 길이:** 14자리 (고정, 구분자 없음)

**생성 규칙:**

- LOT 번호는 시스템이 자동 생성 (수동 입력 불가)
- 순번은 월별 해당 모델의 첫 번째 LOT부터 001, 002, 003... 순차 증가
- 매월 1일 00:00 기준으로 순번 초기화
- 동일 월, 동일 모델에서 순번은 순차적으로 증가

**LOT 번호 예시:**

| LOT 번호 | 설명 |
|----------|------|
| `KR01PSA2511001` | PSA 모델, 한국 1라인, 2025년 11월 첫 번째 LOT |
| `KR01PSA2511002` | PSA 모델, 한국 1라인, 2025년 11월 두 번째 LOT |
| `KR01WFO2511001` | WFO 모델, 한국 1라인, 2025년 11월 첫 번째 LOT |
| `KR01PSA2512001` | PSA 모델, 한국 1라인, 2025년 12월 첫 번째 LOT (월 변경으로 순번 초기화) |

**확장성:**

- 향후 다른 모델 추가 시: `KR01AGR2511001` (AGR = Agriculture 농업용 모델)
- 향후 생산 라인 추가 시: `KR02PSA2511001` (한국 2라인), `US01PSA2511001` (미국 1라인)

### 2.6.2 시리얼 번호 체계

**형식:** `[국가코드][라인번호][모델코드][생산월][LOT순번][제품순번]`

**예시:** `KR01PSA25110010001`

**구성 요소:**

| 구분 | 길이 | 설명 | 예시 | 비고 |
|------|------|------|------|------|
| 국가코드 | 2자리 | 생산 국가 코드 | KR | 한국=KR, 미국=US |
| 라인번호 | 2자리 | 생산 라인 번호 | 01 | 01~99 |
| 모델코드 | 3자리 | 제품 모델 약어 | PSA | PSA10→PSA, Withforce→WFO |
| 생산월 | 4자리 | 생산 월 | 2511 | YYMM 형식 (2025년 11월) |
| LOT순번 | 3자리 | 월별 LOT 순번 | 001 | 001~999 |
| 제품순번 | 4자리 | LOT 내 제품 순서 | 0001 | 0001~9999 (일반적으로 0001~0100) |

**전체 길이:** 18자리 (고정, 구분자 없음)

**생성 규칙:**

- 시리얼 번호는 **라벨 프린팅 공정(공정 7)**에서 자동 생성
- 제품 순번은 LOT당 0001부터 시작하여 순차 증가
- LOT 목표 수량이 100개이므로 일반적으로 0001~0100 범위
- 생성 순서는 라벨 프린팅 공정 착공 순서
- 생성 후 바코드 라벨로 출력되어 제품에 부착

**시리얼 번호 예시:**

| 시리얼 번호 | 설명 |
|-------------|------|
| `KR01PSA25110010001` | 해당 LOT의 첫 번째 제품 |
| `KR01PSA25110010050` | 해당 LOT의 50번째 제품 |
| `KR01PSA25110010100` | 해당 LOT의 100번째 (마지막) 제품 |

**시리얼 번호 활용:**

- 제품 개체 식별 및 추적
- 전 공정 이력 추적
- 불량 발생 시 원인 분석
- A/S 및 품질 보증
- 리콜 발생 시 대상 제품 특정

### 2.6.3 WIP ID 시스템

#### 개요
WIP (Work In Progress) ID는 공정 1~6에서 개별 제품을 추적하기 위한 임시 식별자입니다. 공정 7(라벨 프린팅)에서 최종 Serial Number로 전환됩니다.

#### WIP ID 포맷
- **형식**: `WIP-{LOT}-{SEQ:03d}`
- **예시**: `WIP-KR01PSA2511-001`
- **길이**: 19자 (WIP- 4자 + LOT 11자 + - 1자 + SEQ 3자)
- **순번 범위**: 001~100 (LOT당 최대 100개)

**구성 요소**:
- 접두어: `WIP-` (Work In Progress 식별자)
- LOT 번호: 11자리 (예: KR01PSA2511)
- 구분자: `-`
- 순번: 3자리 (001~100)

#### WIP vs Serial vs LOT 비교

| 구분 | WIP ID | Serial Number | LOT Number |
|------|--------|---------------|------------|
| **목적** | 공정 중 개별 제품 추적 | 최종 제품 식별 | 생산 배치 관리 |
| **생성 시점** | 공정 1 (레이저 마킹) | 공정 7 (라벨 프린팅) | 생산 계획 시 |
| **사용 범위** | 공정 1~6 | 공정 7~8 | 전체 공정 |
| **포맷** | `WIP-{LOT}-{SEQ:03d}` | `{LOT}{SEQ:04d}` | `{COUNTRY}{YEAR}{PRODUCT}{MONTH}` |
| **예시** | `WIP-KR01PSA2511-001` | `KR01PSA25110001` | `KR01PSA2511` |
| **길이** | 19자 | 15자 | 11자 |
| **수량** | LOT당 1~100개 | LOT당 1~100개 | 제한 없음 |

#### WIP 생명주기

```
[LOT 생성]
    ↓
[공정 1: WIP 생성] ← WIP ID 발급 (WIP-KR01PSA2511-001)
    ↓
[공정 2~6: WIP 추적] ← WIP ID 스캔으로 진행
    ↓
[공정 7: Serial 전환] ← WIP → Serial 변환 (KR01PSA25110001)
    ↓
[공정 8: Serial 사용] ← Serial Number로 완료
```

#### WIP 상태 전이

- **CREATED**: WIP ID 생성 직후 (공정 1)
- **IN_PROGRESS**: 공정 진행 중 (공정 2~6)
- **COMPLETED**: 모든 공정 1~6 완료 (PASS)
- **FAILED**: 공정 실패 (불량 발생)
- **CONVERTED**: Serial로 전환 완료 (공정 7)

#### REWORK 워크플로우

REWORK는 공정 실패 후 재작업을 허용하는 프로세스입니다:

1. 공정 완료 시 결과: **PASS**, **FAIL**, **REWORK**
2. REWORK 선택 시:
   - WIP 상태: IN_PROGRESS 유지 (FAILED 아님)
   - 해당 공정 재실행 가능
   - REWORK 횟수: 무제한 (비즈니스 정책)
3. REWORK 후 최종 결과: PASS 또는 FAIL

#### 비즈니스 규칙

- **BR-001**: LOT 생성 시 상태는 CREATED여야 함
- **BR-002**: WIP 생성 시 LOT 상태가 IN_PROGRESS로 변경됨
- **BR-003**: 공정 시작 조건: 이전 공정이 PASS (공정 1 제외)
- **BR-004**: 동일 공정에 중복 PASS 불가
- **BR-005**: Serial 전환 조건: 모든 공정 1~6이 PASS
- **BR-006**: LOT당 최대 100개 WIP 생성 가능
- **BR-007**: WIP ID는 전역적으로 고유해야 함

---

## 2.7 불량 유형 코드 체계

**목적:** 공정별 불량 유형을 표준화하여 일관된 불량 분류 및 통계 분석 가능

**사용 위치:**
- 완공 데이터 전송 시 `defect_type` 필드에 사용
- 불량 통계 및 분석 시 기준 코드로 활용
- 상세 내용은 [3.1 기능 요구사항 - 품질 및 불량 관리](./03-requirements/03-1-functional.md#품질-및-불량-관리) 참조

**공정별 불량 유형 코드:**

| 공정 | 불량 유형 코드 | 설명 | 비고 |
|------|---------------|------|------|
| **공정 2 (LMA 조립)** | PART_DEFECT | 부품 불량 | SMA 스프링, 플라스틱 부품 등 |
| | ASSEMBLY_ERROR | 조립 불량 | 체결 불량, 순서 오류 등 |
| **공정 3 (센서 검사)** | SENSOR_TEMP_FAIL | 온도 센서 이상 | 측정값 범위 초과 |
| | SENSOR_TOF_FAIL | TOF 센서 이상 | I2C 통신 실패 |
| **공정 4 (펌웨어 업로드)** | FIRMWARE_UPLOAD_FAIL | 펌웨어 업로드 실패 | 업로드 중단, 검증 실패 |
| | FIRMWARE_COMM_ERROR | 통신 오류 | 케이블 접촉 불량, 포트 오류 |
| **공정 5 (로봇 조립)** | ASSEMBLY_ERROR | 조립 불량 | 체결 불량 |
| | APPEARANCE_DEFECT | 외관 손상 | 스크래치, 파손 등 |
| **공정 6 (성능검사)** | PERFORMANCE_FAIL | 성능 미달 | 힘 측정값 규격 미달 |
| **공정 7 (라벨 프린팅)** | LABEL_PRINT_FAIL | 라벨 출력 실패 | 프린터 오류, 용지 부족 |
| | LABEL_ATTACH_ERROR | 라벨 부착 불량 | 위치 오류, 접착 불량 |

**불량 유형 코드 사용 예시:**

완공 데이터에서 불량 발생 시:
```json
{
  "result": "FAIL",
  "process_data": {
    "defect_type": "SENSOR_TEMP_FAIL",
    "defect_description": "온도 센서 측정값 58.0℃ (허용범위: 59-61℃)"
  }
}
```

**코드 확장:**
- 향후 새로운 불량 유형 발생 시 이 테이블에 추가
- 코드 명명 규칙: `[카테고리]_[상세]_[상태]` 형식 (예: SENSOR_TEMP_FAIL)

---

## 2.8 API 에러 코드 체계

**목적:** MES API 호출 시 발생할 수 있는 에러를 표준화하여 일관된 에러 처리 및 디버깅 지원

**사용 위치:**

- 착공/완공 API 응답의 에러 처리
- 프론트엔드 에러 메시지 표시
- 에러 로그 및 모니터링
- 상세 내용은 [3.2 API 명세](./03-requirements/03-2-api-specs.md) 참조

**주요 에러 코드:**

| 에러 코드 | 설명 | HTTP 상태 | 비고 |
|-----------|------|-----------|------|
| LOT_NOT_FOUND | LOT 번호가 존재하지 않음 | 404 | LOT 번호 확인 필요 |
| PREVIOUS_PROCESS_NOT_COMPLETED | 이전 공정 미완료 | 400 | 공정 순서 준수 필요 |
| DUPLICATE_START | 이미 착공된 공정 (재시도는 허용, PASS 완공 후는 불가) | 409 | 작업 상태 확인 필요 |
| INVALID_PROCESS_SEQUENCE | 잘못된 공정 순서 | 400 | 공정 흐름도 참조 |
| WORKER_NOT_FOUND | 작업자 ID 없음 | 404 | 작업자 등록 확인 |
| PROCESS_ALREADY_PASSED | 이미 PASS 완공된 공정 - 착공 불가 | 409 | 해당 LOT 작업 완료됨 |
| DUPLICATE_PASS_COMPLETE | 이미 PASS 완공된 공정 - 완공 중복 불가 | 409 | 중복 완공 방지 |
| PROCESS_NOT_STARTED | 착공하지 않은 공정 | 400 | 착공 먼저 진행 필요 |
| INVALID_PROCESS_DATA | 공정 데이터 검증 실패 | 400 | 필수 데이터 확인 |
| SERIAL_NOT_FOUND | 시리얼 번호 미존재 | 404 | 시리얼 발행 확인 필요 |
| PRINTER_NOT_FOUND | 프린터 ID가 등록되지 않음 | 404 | 프린터 설정 확인 |
| PRINTER_NOT_CONNECTED | 프린터 연결 끊김 | 503 | 프린터 전원 및 케이블 확인 |
| PRINTER_OUT_OF_PAPER | 용지 부족 | 503 | 라벨 용지 보충 |
| INVALID_LABEL_DATA | 라벨 데이터 형식 오류 | 400 | 요청 데이터 확인 |

**에러 응답 형식:**

```json
{
  "success": false,
  "error": {
    "code": "PREVIOUS_PROCESS_NOT_COMPLETED",
    "message": "이전 공정이 완료되지 않았습니다",
    "details": {
      "current_process": "센서 검사",
      "required_process": "LMA 조립",
      "required_action": "LMA 조립 공정을 먼저 완료해주세요"
    }
  }
}
```

**에러 코드 확장:**
- 향후 새로운 에러 상황 발생 시 이 테이블에 추가
- 코드 명명 규칙: `[대상]_[상태]_[동작]` 형식 (예: LOT_NOT_FOUND)
- HTTP 상태 코드는 REST API 표준 준수

---

> **이전 섹션:** [1. 프로젝트 개요](./01-project-overview.md)
> **다음 섹션:** [3. MES 요구사항 (TO-BE)](./03-requirements/03-1-functional.md)
