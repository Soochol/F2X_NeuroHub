# =============================================================================
# F2X NeuroHub MES - Demo Docker Compose (Override)
# Usage: docker compose -f docker-compose.yml -f docker-compose.demo.yml --env-file .env.demo up -d
# =============================================================================

services:
  # -------------------------------------------------------------------------
  # PostgreSQL Database - Demo
  # -------------------------------------------------------------------------
  postgres:
    container_name: f2x-demo-postgres
    env_file:
      - .env.demo
    volumes:
      - postgres_demo_data:/var/lib/postgresql/data
    networks:
      - f2x-demo-network

  # -------------------------------------------------------------------------
  # Backend API - Demo (리소스 제한)
  # -------------------------------------------------------------------------
  backend:
    container_name: f2x-demo-backend
    env_file:
      - .env.demo
    networks:
      - f2x-demo-network
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 2G
        reservations:
          cpus: '0.5'
          memory: 512M

  # -------------------------------------------------------------------------
  # Nginx - Demo
  # -------------------------------------------------------------------------
  nginx:
    container_name: f2x-demo-nginx
    ports:
      - "${HTTP_PORT:-8080}:80"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/conf.d/default.conf:ro
    networks:
      - f2x-demo-network
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 512M

  # -------------------------------------------------------------------------
  # Tablet Scanner - Demo (HTTPS for camera access)
  # -------------------------------------------------------------------------
  tablet-scanner:
    container_name: f2x-demo-tablet-scanner
    build:
      context: ./tablet-scanner
      dockerfile: Dockerfile
    ports:
      - "${TABLET_SCANNER_PORT:-5175}:443"
    depends_on:
      backend:
        condition: service_healthy
    networks:
      - f2x-demo-network
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 512M

# =============================================================================
# Networks
# =============================================================================
networks:
  f2x-demo-network:
    driver: bridge
    name: f2x-demo-network

# =============================================================================
# Volumes
# =============================================================================
volumes:
  postgres_demo_data:
    name: f2x-demo-postgres-data
